<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>Introduction to vigil</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Vigil</span> <span class="project-version">0.1.1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="intro.html"><div class="inner"><span>Introduction to vigil</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 "><a href="vigil.core.html"><div class="inner"><span>vigil.core</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#introduction-to-vigil" name="introduction-to-vigil"></a>Introduction to vigil</h1>
<p>Vigil is a library that creates <a href="https://github.com/ztellman/manifold">Manifold</a> streams out of files. Creating a Manifold stream lets you monitor a file as a stream, producing data as content is appended to the file.</p>
<p>As Manifold streams, the streams can be combined with different asynchronous abstractions: channels, lazy sequences, promises, and so forth. Here are some examples.</p>
<h2><a href="#examples" name="examples"></a>Examples</h2>
<p>Here are some examples on how you would use Vigil.</p>
<h3><a href="#simple-file-monitoring-as-a-manifold-stream" name="simple-file-monitoring-as-a-manifold-stream"></a>Simple file monitoring as a Manifold stream</h3>
<pre><code class="clojure">(require '[vigil.core :as v]
         '[manifold.stream :as s])

;; /foo/bar/baz contains "hello\nworld"
(def stream (v/watch-file "/foo/bar/baz"))

@(s/take! stream)
;; =&gt; ("hello" "world")

(spit "/foo/bar/baz" "blah\n" :append true)

;; the new line has now been pushed to the stream
@(s/take! stream)
;; =&gt; ("blah")

;; shut down the watcher
(s/close! stream)

</code></pre>
<h3><a href="#turn-a-file-into-a-core-async-channel" name="turn-a-file-into-a-core-async-channel"></a>Turn a file into a core.async channel</h3>
<pre><code class="clojure">(require '[manifold.stream :as s]
         '[vigil.core :as v]
         '[clojure.core.async :as a])
         
(def fs (v/watch-file "/foo/bar/baz"))
(def ch (a/chan))

;; forward fs into ch
(s/connect fs ch)

(a/go-loop []
  (when-let [stuff (a/&lt;! ch)]
    (println stuff)
    (recur)))
       
(Thread/sleep 60000)

;; append content into /foo/bar/baz (manually)
;; ... and it shall be printed to *out*

;; if you pass :upstream? true to s/connect,
;; closing the channel will close fs, thereby
;; shutting down the watcher
(a/close! ch)
(s/close! fs)

</code></pre>
<h4><a href="#deletion-or-truncation" name="deletion-or-truncation"></a>Deletion or truncation</h4>
<p>If you delete the file, the watcher will stop. Truncating the file will make the watcher reset its <em>cursor</em> to the beginning. Truncation occurs when the cursor location has been observed to be greater than the length of the file.</p></div></div></div></body></html>